{% extends 'base.html.twig' %}

{% block body %}
    <h1 style="text-align : center;">Confirm your order</h1>
    <hr />
    <div class="card">
        <div class="card-header">
            <h3>You order contains :</h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-8">
                    <table class="table">
                        <thead class="thead-light">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Description</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for desc in orderDescList %}
                            <tr>
                                <th scope="row"></th>
                                <td>{{ desc }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="col-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title">Order total</h5>
                        </div>
                        <div class="card-body">
                            <p class="card-text currency">{{ totalPrice }}â‚¬</p>
                            <p class="card-text" style="text-align:center;"><strong>Proceed the payement</strong></p>
                            <row>
                                <div id="paypal-button"></div>
                            </row>
                            <div class="spacer"></div>
                            <row>
                                <form action="/payment/cancelOrder" method="post">
                                    <input class="btn btn-danger" style="width: 100%;" type="submit" value="No">
                                </form>
                            </row>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block stylesheets %}
    <style>

        .currency {
            font-size: 4rem;
            font-weight: 300 + 100;
            letter-spacing: 0px;
            text-align:center;
        }

        .spacer {
            height: 5px;
        }

    </style>
{% endblock %}

{% block javascripts %}

    <script src="https://www.paypalobjects.com/api/checkout.js"></script>

    <script>
        var CREATE_PAYMENT_URL  = '/payement/create-payment';
        var EXECUTE_PAYMENT_URL = '/payement/confirmOrder';

        paypal.Button.render({

            env: 'sandbox', // Or 'sandbox'

            client: {
                sandbox:    'AbZExQqOa9AIQnM7q8iOG7PF7fFnO926qUoRNg9A_Yth9pFBGdGSQm1sZtloOr_J8nXaknWN-tsewgrH',
            },

            commit: true, // Show a 'Pay Now' button

            payment: function() {
                return paypal.request.post(CREATE_PAYMENT_URL).then(function(data) {
                    return data.id;
                });
            },
            /*OLD payment: function(data, actions) {
                return actions.payment.create({
                    payment: {
                        transactions: [
                            {
                                amount:
                                    { total: {{ totalPrice }},
                                        currency: 'EUR' ,
                                        details:{
                                           // checksum : "{{ checksum }}"
                                        }
                                    }
                            }
                        ]
                    }
                });
            },*/

            onAuthorize: function(data) {
                return paypal.request.post(EXECUTE_PAYMENT_URL, {
                    paymentID: data.paymentID,
                    payerID:   data.payerID
                }).then(function() {
                    // The payment is complete!
                    // You can now show a confirmation message to the customer
                    alert(JSON.stringify(payment));
                });
            },

            onCancel: function(data, actions) {

            },

            onError: function(err) {
                /*
                 * An error occurred during the transaction
                 */
            }

        }, '#paypal-button');
    </script>

{% endblock %}
